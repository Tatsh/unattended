<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Unattended Windows Installation:  The OS</title>
</head>
<body>

<p>This document is part of <a
href="http://unattended.sourceforge.net/"
>http://unattended.sourceforge.net/</a>.

<hr>
<h1>Overview</h1>

To perform an unattended installation of Windows NT, 2000, or XP, you
need to:

<ol>
<li><a href="#install-share">Create the OS distribution point</a>
(basically, a folder holding a copy of the Windows CD-ROM)

<li><a href="#bootdisk">Create the DOS network boot disk</a>

<li><a href="#go">Boot from it</a>, answer a bunch of questions, and
go get a snack while the OS installs

</ol>

<h1 id="install-share">Create the OS distribution point</h1>

<p>In principle, the OS distribution point could be CD-ROM or a local
disk directory, but we are going to use a network share.

<h2>Create the \\ntinstall\install share</h2>
<p>Copy the <code>install</code> directory tree from this project's
distribution to a Windows file server (say, a Unix box running <a
href="http://www.samba.org/">Samba</a>), and export it read-only with
guest access permitted.  The sample scripts, and this documentation,
assume that this share is named <code>\\ntinstall\install</code>.  In
other words, the name <code>ntinstall</code> is an alias for the file
server and the share is named <code>install</code>.  If you want to
use different names, that is OK, but you will need to modify the
scripts to refer to it (just search for "ntinstall").

<p>OS installation relies on these files and directories in the
<code>install</code> share:

<dl>

<dt><a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/djgpp/"
>djgpp</a>

<dd>Contains parts of <a
href="http://www.delorie.com/djgpp/">DJGPP</a>, a collection of Unix
tools for DOS.  This one is too big to bundle, so you will need to
download it yourself; <a href="#djgpp">see below</a> for instructions.
(Is it really worth all this just so we can write a Bourne shell
script instead of a <code>.bat</code> file?  Yes, it is.)

<dt><a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/dosbin/"
>dosbin</a>

<dd>Directory containing DOS utility programs (like fdisk) from the <a
href="http://www.freedos.org/">FreeDOS</a> project.

<dt><a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/install.sh?rev=HEAD&amp;content-type=text/vnd.viewcvs-markup"
>install.sh</a>

<dd>Shell script run by <code>autoexec.bat</code> from the bootdisk.
This is the first entry point to the networked portion of the
installation.  This is the script which asks you a bunch of questions,
then fires off the actual unattended installation.

<dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/unattend.txt?rev=HEAD&amp;content-type=text/vnd.viewcvs-markup" >unattend.txt</a>

<dd>Prototype <code>unattend.txt</code>.  The <code>install.sh</code>
script will copy this to your local drive and offer to let you edit
it.  See below for more information.

<dt><a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/win2k/"
>win2k</a>

<dd>Directory holding a copy of the <code>i386</code> folder from a
Windows 2000 CD-ROM.  You will need to populate this if you want to
install Win2k (as <a href="http:cd-rom">described below</a>).

<dt><a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/win2ksp3/"
>win2ksp3</a>

<dd>Just like <code>win2k</code>, but with Service Pack 3 already
integrated (also <a href="http:service-pack">described below</a>).

<dt><a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/winxp/"
>winxp</a>

<dd>Similarly, but for Windows XP.

<dt><a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/install/winxpsp1/"
>winxpsp1</a>

<dd>Similarly, but for Windows XP with integrated Service Pack 1.

</dl>

<h2 id="djgpp">Download DJGPP</h2>

<p><a href="http://www.delorie.com/djgpp/">DJGPP</a> is a port of the
Unix environment to DOS.  You will need to download the following
components:

<ul>
<li>The basic development kit (<a
href="ftp://ftp.simtel.net/pub/simtelnet/gnu/djgpp/v2/djdev203.zip"
>v2/djdev203.zip</a>)

<li>The DPMI server (<a
href="ftp://ftp.simtel.net/pub/simtelnet/gnu/djgpp/v2misc/csdpmi5b.zip"
>v2misc/csdpmi5b.zip</a>)

<li>The Bash port (<a
href="ftp://ftp.simtel.net/pub/simtelnet/gnu/djgpp/v2gnu/bsh204b.zip"
>v2gnu/bsh204b.zip</a>)

</ul>

<p>Just unzip all of them under
<code>\\ntinstall\install\djgpp</code>.

<h2 id="cd-rom">Copy the Windows CD-ROM to the share</h2>
<p>Copy the <code>i386</code> folder from the Windows CD-ROM to the
appropriate subdirectory of the <code>install</code> share.  For
example, for Windows 2000 Service Pack 3, copy the <code>i386</code>
folder to <code>\\ntinstall\install\win2ksp3</code>.

<h3 id="service-pack">Integrate the service pack (optional)</h3>

<p>This step is optional; you can apply a service pack together with
all the other hotfixes later.  But combining the service pack into the
distribution point now will make installation faster.

<p>To apply the service pack to the installation point, use the
"slipstreaming" feature introduced in Windows 2000 Service Pack 1
(i.e., not supported by NT).  You can find details in Microsoft's <a
href="http://www.microsoft.com/windows2000/downloads/servicepacks/sp3/spdeploy.htm"
>Installation and Deployment Guide for Win2k SP3</a>, but the process
is pretty simple.  Using Win2k SP3 as an example:

<ol>

<li>Download <a
href="http://www.microsoft.com/windows2000/downloads/servicepacks/sp3/"
>the service pack (<code>w2ksp3.exe</code>)</a> from Microsoft.

<li>Run
<pre>
    w2ksp3.exe /u /x:c:\sp3
</pre>
<p>This extracts the service pack files to <code>c:\sp3</code>.

<li>Run
<pre>
    c:\sp3\i386\update\update.exe /s:\\ntinstall\install\win2ksp3
</pre>

<p>This applies the service pack to the distribution point
<code>\\ntinstall\install\win2ksp3</code>, creating an integrated
("slipstreamed") Win2k SP3 tree.  Due to a bug, you must be a local
administrator for this command to work, even if you have write access
to the target folder.

</ol>

<h1 id="bootdisk">Create the DOS network boot disk</h1>

<p>The goal here is very simple: To boot to DOS so we can mount
<code>\\ntinstall\install</code> as the <code>Z:</code> drive and run
the <code>install.sh</code> script.

<h2>Booting from floppy</h2>

<p>The <a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/bootdisk/"
>bootdisk</a> directory from this project will help you create a
bootable DOS disk with network access.  Simply
<kbd>cd&nbsp;bootdisk</kbd> and run <kbd>make&nbsp;images</kbd> to
generate a bunch of floppy disk images in the <code>images</code>
subdirectory.

<p>You will find one floppy disk image for each supported network
driver, named after the NDIS driver for that card.  The <a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/bootdisk/DRIVERS.txt?rev=HEAD&amp;content-type=text/vnd.viewcvs-markup"
>DRIVERS.txt</a> file describes the supported drivers.

<p>You will need to use the floppy image with the right driver for
your network card.  If you are not sure which driver is right, you may
need to try them all (but see below about <a href="#netboot">booting
directly from the network</a>).

<p>The <a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/bootdisk/template"
>template</a> subdirectory contains the files on the boot disk itself.
For example, if you want to change <a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/bootdisk/template/autoexec.bat?rev=HEAD&amp;content-type=text/vnd.viewcvs-markup"
>autoexec.bat</a> or <a
href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/unattended/unattended/bootdisk/template/config.sys?rev=HEAD&amp;content-type=text/vnd.viewcvs-markup"
>config.sys</a>, just edit them there and run
<kbd>make&nbsp;images</kbd> again.

<p>Once you have picked the correct floppy image for your network
card, you will need to write it to a floppy.  How you do this depends
on your operating system; on Linux, something like
<pre>
    dd&nbsp;if=images/e100b.img&nbsp;of=/dev/fd0
</pre>

<p>...will do the trick.

<h2>Booting from CD-ROM or network</h2>

<p>These sections are optional; you can kick off the installation
process just using a floppy.  But a CD-ROM is faster, and it can hold
ALL of the floppy images at once.  And "nothing-but-net" installs are
the most fun, although I still find them a little creepy.  Still, you
should probably skip these sections the first time through.  Once you
have the whole process working from floppy, moving to a CD-ROM or
network boot is pretty easy.

<h3>Booting from CD-ROM</h3>
<p>To boot from a CD-ROM, we will use the <a
href="http://syslinux.zytor.com/iso.php">ISOLINUX</a> and <a
href="http://syslinux.zytor.com/memdisk.php">memdisk</a> utilities
from the excellent <a href="http://syslinux.zytor.com/">SYSLINUX</a>
package.  (Do not be fooled by the name; SYSLINUX is a very powerful
boot loader whose use goes far beyond Linux.  It is perfect for this
application, for example.)  Download the SYSLINUX package, and copy
the <code>isolinux</code> and <code>memdisk</code> applications to the
<code>iso</code> directory.  Then type <kbd>make iso</kbd>.  You should end
up with a <code>bootdisk.iso</code> image, suitable for burning to a
CD-ROM.  Booting this CD-ROM will give you a choice of "virtual
floppies" to boot; choose the one with the right driver for your
network card.

<h3 id="netboot">Booting from the network</h3>

<p>Most modern network cards support booting directly from the network
according to Intel's Preboot eXecution Environment (PXE)
specification.  You can download the PXE specification from <a
href="http://www.intel.com/labs/manage/wfm/wfmspecs.htm">Intel's WFM
site</a>, but the basic idea is simple: Just configure your DHCP
server to provide "filename" and "next-server" DHCP options giving to
the file name and TFTP server of the PXE boot loader.

<p>Which boot loader?  We will use <a
href="http://syslinux.zytor.com/pxe.php">PXELINUX</a>, also from the
SYSLINUX package.  This will work just like the ISO CD-ROM boot, using
<code>memdisk</code> to load a virtual floppy, but here you do not care
which network driver to use!  3com has kindly written a "universal"
DOS network driver which runs over any PXE implementation, allowing
one floppy image to support any PXE-compatible network hardware.

<p>NOTE: Historically, by which I mean as recently as this year, PXE
implementations have been extremely buggy.  Always flash the firmware
on your network card to the latest version before attempting a network
boot.  For network hardware embedded on a motherboard or laptop, this
probably means flashing the system BIOS.

<p>In the <code>bootdisk</code> directory, type
<kbd>make&nbsp;tftpboot</kbd>.  This will populate the tftpboot
directory with everything you need; just copy it to /tftpboot on your
TFTP server, set up your DHCP server as described above, and you
should be good to go.

<h1 id="go">Formatting the disk, creating unattend.txt, etc.</h1>

<p>The bootdisk's entire purpose in life is to obtain access to the
network, then hand off control to the more powerful tools available
there.  In particular, the bootdisk mounts
<code>\\ntinstall\install</code> as the <code>Z:</code> drive, then executes
the Bourne shell script <code>z:\install.sh</code>.

<p>The install.sh script will help you partition the drive and format
it.  It will ask you which script to run after the OS installation is
finished; this is the hook by which the <a
href="apps.html">application installation</a> process is kicked off.

<p>Finally, <code>install.sh</code> will copy the sample
<code>z:\unattend.txt</code> file to the <code>c:\</code> drive and offer to
let you edit it.

<p>The <code>unattend.txt</code> file, also known as the "answer file", is
the key to this whole process.  Normally, Windows Setup tosses up lots
of dialogs to ask you questions ("what is your name?", "what is your
license key?", etc.) during the OS installation.  By passing the right
flags to <code>i386\winnt.exe</code>, we will cause Setup to consult this
file for its answers instead.

<p>The best documentation for this file is Microsoft's own "Microsoft
Windows 2000 Guide to Unattended Setup".  (I strongly recommend that
you read it, or at least browse it, before proceeding.)
Unfortunately, as far as I know, you cannot download this document
directly; you must first download and install the <a
href="http://www.microsoft.com/windows2000/downloads/servicepacks/sp3/supporttools.asp"
>Windows 2000 SP3 Support Tools</a>, then use Internet Explorer to
extract the <code>unattend.doc</code> file from the <code>deploy.cab</code>
archive.

<p>Once you understand it, editing <code>unattend.txt</code> is pretty
easy.  And once you have edited it, you can select "Install now" to
run the <code>i386\winnt.exe</code> program with the appropriate
arguments.

<p>Congratulations, your unattended Windows OS installation is on its
way!

</body>
</html>
